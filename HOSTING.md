## Hosting vectara-answer

This guide provides specific instructions to help you host your `vectara-answer` application on one of the popular hosting providers.
We keep adding new hosting providers regularly - please let us know if you need instructions for a hosting provider that is not yet included.

### Overview

To run a hosted version of `vectara-answer` you would need to have two files: `.env` and `queries.json`.

To prepare the `.env` file, which combines the information from `config.yaml` and `secrets.toml`, run the following command:

`python3 prepare_config.py /path/to/<YOUR-CONFIG.yaml> <toml profile (usually default)>`

At the end of this process you should have two files ready to go:
1. `.env` generated by the above python3 command
2. `queries.json` that specifies the queries for your application.

### Deploy vectara-answer on Render

To deploy on Render, please follow these steps:

1. Sign Up/Log In: If you don't have a Render account, you'll need to create one. If you already have one, just log in.
2. Create New Service: Once you're logged in, click on the "New" button usually found on the dashboard and select "Web Service".
3. Choose "Deploy an existing image from a registry" and click "Next"
4. Specify Docker Image: In the "Image URL" fill in "vectara/vectara-answer" and click "Next"
5. Choose a name for your deployment (e.g. "vectara-answer"), and if you need to pick a region or leave the default. Then pick you instance type.
6. Click "Create Web Service"
7. Click "Environment", then "Add Secret File": name the file `.env`, and copy the contents of your local `.env` file
8. Now click "Add Secret File" again and this time name the file `queries.json`, and copy the contents of your local `queries.json` file
9. Click "Settings" and go to "Docker Command" and click "Edit", the put in the following command: 

`/bin/bash -c cp /etc/secrets/queries.json ./build/ && cp /etc/secrets/.env ./ && node server/index.js`

Then click "Save Changes", and your application should now be deployed.

### Deploy vectara-answer on Render Using Render Create Service API

Render provides the API's to manage the services

To deploy the vectara-answer on Render using Api please follow these steps

1. Create API Key: After logging in go to Account Settings and create the API key. Api key can be created on the personal account only.
2. Add payment method in the account because you can't create free-tier services with the Render API.
3. Checkout [Render Create Service API](https://api-docs.render.com/reference/create-service) to see the body params
4. Following is the payload of the API to create the service using github repo. Using the github repo it deploys the in dev mode and need standard plan.
    #### Payload and NodeJs code to execute the request
   Note: EnvVars in the payload are for Vectara Docs. You can use your configuration as well

    ```
    const sdk = require('api')('@render-api/v1.0#aiie8wizhlp1is9bu');
    sdk.auth('API_KEY');
    sdk.createService({
        type: 'web_service',
        autoDeploy: 'yes',
        serviceDetails: {
            pullRequestPreviewsEnabled: 'no',
            env: 'node',
            envSpecificDetails: {buildCommand: 'npm install', startCommand: 'npm run start'},
            plan: 'standard'
       },
       name: 'vectara4',
       ownerId: <Render account Id> Checkout Render Owners API for more details,
       repo: 'https://github.com/vectara/vectara-answer',
       branch: 'main',
       envVars: [
          {value: '1', key: 'REACT_APP_corpus_id'},
          {value: '1366999410', key: 'REACT_APP_customer_id'},
          {value: 'zqt_UXrBcnI2UXINZkrv4g1tQPhzj02vfdtqYJIDiA', key: 'REACT_APP_api_key'},
          {key: 'REACT_APP_endpoint', value: 'api.vectara.io'},
          {key: 'REACT_APP_app_title', value: 'Vectara Docs Search'},
          {key: 'REACT_APP_search_title', value: 'Vectara Docs Search'},
          {key: 'REACT_APP_search_description',
          value: 'All of Vectara\'s Platform Documentation'},
         {key: 'REACT_APP_questions',
         value: '["How do I enable hybrid search?","How is data encrypted?","What is a textless corpus?","How do I configure OAuth?"]'
         },
        {key: 'REACT_APP_enable_source_filters', value: 'False'},
        {key: 'REACT_APP_summary_default_language', value: 'eng'},
        {key: 'REACT_APP_summary_num_sentences', value: '3'},
        {key: 'REACT_APP_summary_num_results', value: '7'}
      ]
    })
   .then(({ data }) => console.log(data))
   .catch(err => console.error(err));
    ```
   Above code would create and deploy the vectara answer service on the Render.You can visit the API docs for more information.
